<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script language="javascript">
		
		window.writings = [];
		//window.writing = [{x:0,y:0}, {x:5, y:0}, {x:90, y:0}, {x:90, y:90}];
		window.writing = [];
		
		window.samples = 		[[{"x":58,"y":19},{"x":48,"y":19},{"x":38,"y":22},{"x":30,"y":28},{"x":22,"y":34},{"x":18,"y":43},{"x":14,"y":52},{"x":11,"y":61},{"x":14,"y":71},{"x":21,"y":77},{"x":29,"y":84},{"x":38,"y":79},{"x":47,"y":75},{"x":55,"y":69},{"x":58,"y":60},{"x":61,"y":50},{"x":61,"y":40},{"x":68,"y":47},{"x":75,"y":55},{"x":82,"y":61},{"x":90,"y":68}],[{"x":23,"y":10},{"x":23,"y":20},{"x":23,"y":30},{"x":23,"y":40},{"x":23,"y":50},{"x":22,"y":60},{"x":21,"y":70},{"x":21,"y":80},{"x":20,"y":90},{"x":25,"y":81},{"x":29,"y":72},{"x":33,"y":63},{"x":41,"y":57},{"x":48,"y":50},{"x":58,"y":49},{"x":68,"y":51},{"x":78,"y":54},{"x":79,"y":64},{"x":81,"y":74},{"x":72,"y":79},{"x":64,"y":84},{"x":55,"y":88},{"x":45,"y":86},{"x":35,"y":84},{"x":28,"y":77}],[{"x":70,"y":21},{"x":61,"y":16},{"x":51,"y":15},{"x":41,"y":14},{"x":32,"y":15},{"x":24,"y":21},{"x":18,"y":29},{"x":11,"y":37},{"x":10,"y":47},{"x":14,"y":56},{"x":19,"y":65},{"x":27,"y":71},{"x":35,"y":76},{"x":43,"y":82},{"x":52,"y":88},{"x":61,"y":84},{"x":71,"y":83},{"x":81,"y":83},{"x":91,"y":82}],[{"x":55,"y":55},{"x":49,"y":47},{"x":39,"y":44},{"x":29,"y":46},{"x":24,"y":54},{"x":18,"y":62},{"x":20,"y":72},{"x":27,"y":79},{"x":35,"y":85},{"x":43,"y":80},{"x":51,"y":74},{"x":57,"y":66},{"x":58,"y":56},{"x":59,"y":46},{"x":59,"y":36},{"x":59,"y":26},{"x":60,"y":17},{"x":61,"y":26},{"x":61,"y":36},{"x":61,"y":46},{"x":61,"y":56},{"x":62,"y":66},{"x":63,"y":76},{"x":69,"y":85},{"x":78,"y":89}],[{"x":31,"y":46},{"x":41,"y":46},{"x":51,"y":46},{"x":59,"y":41},{"x":68,"y":36},{"x":63,"y":27},{"x":55,"y":20},{"x":47,"y":14},{"x":39,"y":8},{"x":32,"y":15},{"x":22,"y":16},{"x":16,"y":23},{"x":9,"y":31},{"x":10,"y":41},{"x":10,"y":51},{"x":14,"y":61},{"x":20,"y":69},{"x":26,"y":77},{"x":32,"y":85},{"x":42,"y":86},{"x":52,"y":87},{"x":61,"y":89},{"x":71,"y":88},{"x":81,"y":87}],[{"x":21,"y":60},{"x":31,"y":59},{"x":41,"y":57},{"x":50,"y":54},{"x":59,"y":49},{"x":68,"y":44},{"x":72,"y":35},{"x":76,"y":26},{"x":73,"y":17},{"x":63,"y":14},{"x":54,"y":11},{"x":48,"y":19},{"x":44,"y":28},{"x":41,"y":38},{"x":38,"y":47},{"x":37,"y":57},{"x":36,"y":67},{"x":36,"y":77},{"x":36,"y":87},{"x":46,"y":90},{"x":55,"y":85},{"x":64,"y":80},{"x":59,"y":71},{"x":54,"y":63},{"x":46,"y":57},{"x":56,"y":55},{"x":66,"y":55},{"x":76,"y":55}],[{"x":70,"y":13},{"x":60,"y":11},{"x":50,"y":10},{"x":40,"y":10},{"x":31,"y":13},{"x":25,"y":22},{"x":19,"y":30},{"x":15,"y":39},{"x":12,"y":48},{"x":8,"y":58},{"x":9,"y":68},{"x":10,"y":78},{"x":10,"y":88},{"x":20,"y":87},{"x":30,"y":90},{"x":40,"y":90},{"x":50,"y":90},{"x":60,"y":90},{"x":70,"y":88},{"x":80,"y":86},{"x":84,"y":77},{"x":86,"y":68},{"x":87,"y":58},{"x":79,"y":53},{"x":71,"y":46},{"x":61,"y":47},{"x":71,"y":47},{"x":81,"y":48}],[{"x":30,"y":10},{"x":30,"y":20},{"x":30,"y":30},{"x":29,"y":40},{"x":28,"y":50},{"x":27,"y":60},{"x":27,"y":70},{"x":32,"y":61},{"x":37,"y":52},{"x":46,"y":49},{"x":56,"y":51},{"x":62,"y":60},{"x":67,"y":68},{"x":71,"y":77},{"x":73,"y":87}],[{"x":51,"y":10},{"x":51,"y":20},{"x":51,"y":30},{"x":51,"y":40},{"x":51,"y":50},{"x":50,"y":60},{"x":49,"y":70},{"x":49,"y":80},{"x":49,"y":90}],[{"x":72,"y":10},{"x":72,"y":20},{"x":73,"y":30},{"x":73,"y":40},{"x":73,"y":50},{"x":72,"y":60},{"x":69,"y":70},{"x":67,"y":79},{"x":59,"y":85},{"x":50,"y":90},{"x":40,"y":87},{"x":32,"y":82},{"x":27,"y":73}],[{"x":26,"y":10},{"x":26,"y":20},{"x":26,"y":30},{"x":26,"y":40},{"x":26,"y":50},{"x":26,"y":60},{"x":26,"y":70},{"x":26,"y":80},{"x":25,"y":90},{"x":29,"y":81},{"x":34,"y":72},{"x":38,"y":63},{"x":44,"y":55},{"x":51,"y":48},{"x":59,"y":41},{"x":66,"y":34},{"x":73,"y":27},{"x":65,"y":34},{"x":58,"y":41},{"x":52,"y":49},{"x":46,"y":57},{"x":43,"y":66},{"x":43,"y":76},{"x":51,"y":83},{"x":60,"y":85},{"x":70,"y":87}],[{"x":35,"y":70},{"x":44,"y":65},{"x":52,"y":59},{"x":60,"y":53},{"x":64,"y":44},{"x":67,"y":34},{"x":65,"y":24},{"x":65,"y":14},{"x":56,"y":19},{"x":46,"y":23},{"x":47,"y":33},{"x":47,"y":43},{"x":46,"y":53},{"x":46,"y":63},{"x":45,"y":72},{"x":44,"y":82},{"x":52,"y":88},{"x":62,"y":87}],[{"x":28,"y":10},{"x":28,"y":20},{"x":28,"y":30},{"x":28,"y":40},{"x":28,"y":50},{"x":28,"y":60},{"x":28,"y":70},{"x":28,"y":80},{"x":28,"y":90},{"x":38,"y":90},{"x":48,"y":90},{"x":58,"y":90},{"x":68,"y":90}],[{"x":14,"y":11},{"x":14,"y":21},{"x":14,"y":31},{"x":14,"y":41},{"x":14,"y":51},{"x":14,"y":61},{"x":14,"y":71},{"x":14,"y":61},{"x":15,"y":51},{"x":17,"y":41},{"x":18,"y":31},{"x":23,"y":23},{"x":28,"y":15},{"x":37,"y":20},{"x":46,"y":25},{"x":46,"y":35},{"x":49,"y":44},{"x":49,"y":54},{"x":49,"y":64},{"x":49,"y":74},{"x":48,"y":84},{"x":48,"y":74},{"x":47,"y":64},{"x":49,"y":54},{"x":50,"y":44},{"x":51,"y":34},{"x":52,"y":25},{"x":58,"y":17},{"x":66,"y":11},{"x":75,"y":16},{"x":82,"y":23},{"x":86,"y":32},{"x":87,"y":42},{"x":88,"y":52},{"x":86,"y":62}],[{"x":11,"y":90},{"x":13,"y":80},{"x":14,"y":70},{"x":16,"y":60},{"x":15,"y":50},{"x":15,"y":40},{"x":15,"y":30},{"x":18,"y":21},{"x":22,"y":12},{"x":22,"y":22},{"x":25,"y":31},{"x":29,"y":40},{"x":31,"y":50},{"x":34,"y":60},{"x":36,"y":69},{"x":36,"y":79},{"x":41,"y":88},{"x":47,"y":80},{"x":54,"y":73},{"x":58,"y":64},{"x":63,"y":55},{"x":67,"y":46},{"x":70,"y":37},{"x":72,"y":27},{"x":75,"y":17},{"x":82,"y":24},{"x":84,"y":34},{"x":84,"y":44},{"x":85,"y":54},{"x":85,"y":64},{"x":87,"y":74},{"x":88,"y":83}],[{"x":15,"y":90},{"x":16,"y":80},{"x":18,"y":70},{"x":19,"y":60},{"x":19,"y":50},{"x":19,"y":40},{"x":19,"y":30},{"x":19,"y":20},{"x":27,"y":27},{"x":35,"y":33},{"x":38,"y":42},{"x":42,"y":51},{"x":49,"y":59},{"x":56,"y":66},{"x":62,"y":74},{"x":70,"y":80},{"x":78,"y":86},{"x":81,"y":76},{"x":83,"y":66},{"x":83,"y":56},{"x":85,"y":47},{"x":87,"y":37},{"x":86,"y":27},{"x":86,"y":17}],[{"x":52,"y":12},{"x":42,"y":16},{"x":34,"y":21},{"x":28,"y":29},{"x":22,"y":37},{"x":19,"y":47},{"x":16,"y":56},{"x":17,"y":66},{"x":22,"y":74},{"x":29,"y":82},{"x":37,"y":88},{"x":47,"y":90},{"x":57,"y":90},{"x":67,"y":90},{"x":73,"y":83},{"x":79,"y":75},{"x":85,"y":66},{"x":84,"y":56},{"x":83,"y":46},{"x":81,"y":37},{"x":79,"y":27},{"x":72,"y":20},{"x":64,"y":14},{"x":54,"y":10}],[{"x":30,"y":13},{"x":31,"y":23},{"x":31,"y":33},{"x":31,"y":43},{"x":31,"y":53},{"x":31,"y":63},{"x":31,"y":73},{"x":32,"y":83},{"x":33,"y":93},{"x":34,"y":83},{"x":34,"y":73},{"x":35,"y":63},{"x":36,"y":53},{"x":36,"y":43},{"x":36,"y":33},{"x":36,"y":23},{"x":37,"y":13},{"x":47,"y":11},{"x":57,"y":10},{"x":65,"y":15},{"x":70,"y":24},{"x":68,"y":34},{"x":67,"y":44},{"x":58,"y":49},{"x":48,"y":52},{"x":38,"y":51}],[{"x":35,"y":90},{"x":36,"y":80},{"x":36,"y":70},{"x":36,"y":60},{"x":36,"y":50},{"x":36,"y":40},{"x":36,"y":30},{"x":36,"y":20},{"x":36,"y":10},{"x":46,"y":10},{"x":56,"y":13},{"x":65,"y":16},{"x":66,"y":26},{"x":64,"y":36},{"x":56,"y":42},{"x":47,"y":47},{"x":38,"y":45}],[{"x":48,"y":14},{"x":38,"y":11},{"x":28,"y":14},{"x":21,"y":21},{"x":16,"y":30},{"x":11,"y":39},{"x":21,"y":40},{"x":31,"y":40},{"x":41,"y":37},{"x":47,"y":29},{"x":49,"y":19},{"x":49,"y":29},{"x":49,"y":39},{"x":48,"y":49},{"x":48,"y":59},{"x":47,"y":69},{"x":47,"y":79},{"x":48,"y":89},{"x":55,"y":82},{"x":63,"y":76},{"x":71,"y":70},{"x":77,"y":63}],[{"x":66,"y":15},{"x":57,"y":11},{"x":47,"y":10},{"x":39,"y":16},{"x":30,"y":22},{"x":34,"y":31},{"x":41,"y":38},{"x":51,"y":38},{"x":61,"y":39},{"x":60,"y":29},{"x":59,"y":19},{"x":59,"y":29},{"x":59,"y":39},{"x":59,"y":49},{"x":58,"y":59},{"x":58,"y":69},{"x":57,"y":79},{"x":58,"y":89}],[{"x":26,"y":10},{"x":27,"y":20},{"x":27,"y":30},{"x":27,"y":40},{"x":27,"y":50},{"x":27,"y":60},{"x":27,"y":70},{"x":27,"y":80},{"x":27,"y":90},{"x":30,"y":80},{"x":32,"y":71},{"x":33,"y":61},{"x":33,"y":51},{"x":35,"y":41},{"x":38,"y":31},{"x":42,"y":22},{"x":49,"y":16},{"x":59,"y":13},{"x":68,"y":17}],[{"x":23,"y":10},{"x":26,"y":19},{"x":27,"y":29},{"x":28,"y":39},{"x":28,"y":49},{"x":29,"y":59},{"x":29,"y":69},{"x":29,"y":79},{"x":29,"y":89},{"x":29,"y":79},{"x":29,"y":69},{"x":29,"y":59},{"x":29,"y":49},{"x":32,"y":40},{"x":36,"y":31},{"x":40,"y":22},{"x":50,"y":19},{"x":58,"y":25},{"x":54,"y":34},{"x":44,"y":38},{"x":35,"y":42},{"x":25,"y":41},{"x":28,"y":51},{"x":33,"y":59},{"x":41,"y":66},{"x":48,"y":73},{"x":57,"y":78},{"x":66,"y":82},{"x":74,"y":88}],[{"x":29,"y":85},{"x":29,"y":75},{"x":29,"y":65},{"x":29,"y":55},{"x":29,"y":45},{"x":29,"y":35},{"x":31,"y":25},{"x":31,"y":15},{"x":40,"y":12},{"x":50,"y":14},{"x":58,"y":19},{"x":66,"y":25},{"x":62,"y":34},{"x":53,"y":38},{"x":43,"y":40},{"x":34,"y":43},{"x":38,"y":52},{"x":42,"y":61},{"x":50,"y":67},{"x":58,"y":74},{"x":65,"y":81},{"x":72,"y":88}],[{"x":75,"y":11},{"x":65,"y":10},{"x":56,"y":14},{"x":47,"y":19},{"x":39,"y":25},{"x":35,"y":34},{"x":31,"y":43},{"x":40,"y":47},{"x":50,"y":50},{"x":59,"y":52},{"x":66,"y":60},{"x":68,"y":69},{"x":71,"y":79},{"x":64,"y":87},{"x":54,"y":86},{"x":44,"y":86},{"x":35,"y":82},{"x":26,"y":78}],[{"x":19,"y":10},{"x":29,"y":10},{"x":39,"y":10},{"x":49,"y":10},{"x":59,"y":10},{"x":69,"y":10},{"x":79,"y":10},{"x":69,"y":11},{"x":59,"y":12},{"x":49,"y":14},{"x":50,"y":24},{"x":51,"y":33},{"x":51,"y":43},{"x":51,"y":53},{"x":51,"y":63},{"x":51,"y":73},{"x":51,"y":83}],[{"x":24,"y":44},{"x":33,"y":47},{"x":43,"y":47},{"x":53,"y":47},{"x":63,"y":47},{"x":59,"y":38},{"x":55,"y":29},{"x":51,"y":19},{"x":46,"y":10},{"x":46,"y":20},{"x":45,"y":30},{"x":45,"y":40},{"x":45,"y":50},{"x":45,"y":60},{"x":45,"y":70},{"x":46,"y":80},{"x":52,"y":89},{"x":61,"y":90},{"x":71,"y":90}],[{"x":19,"y":10},{"x":19,"y":20},{"x":19,"y":30},{"x":19,"y":40},{"x":19,"y":50},{"x":19,"y":60},{"x":19,"y":70},{"x":19,"y":80},{"x":26,"y":87},{"x":36,"y":89},{"x":46,"y":90},{"x":56,"y":90},{"x":65,"y":88},{"x":72,"y":81},{"x":77,"y":72},{"x":81,"y":62},{"x":81,"y":52},{"x":81,"y":42},{"x":81,"y":32},{"x":81,"y":22}],[{"x":25,"y":10},{"x":23,"y":20},{"x":21,"y":30},{"x":20,"y":40},{"x":20,"y":50},{"x":20,"y":60},{"x":19,"y":70},{"x":19,"y":80},{"x":28,"y":85},{"x":37,"y":87},{"x":47,"y":85},{"x":57,"y":82},{"x":61,"y":73},{"x":66,"y":64},{"x":68,"y":55},{"x":69,"y":45},{"x":68,"y":35},{"x":68,"y":25},{"x":70,"y":34},{"x":71,"y":44},{"x":71,"y":54},{"x":73,"y":64},{"x":75,"y":74},{"x":78,"y":84}],[{"x":14,"y":10},{"x":16,"y":20},{"x":18,"y":30},{"x":20,"y":39},{"x":23,"y":49},{"x":27,"y":58},{"x":30,"y":68},{"x":37,"y":75},{"x":42,"y":84},{"x":50,"y":79},{"x":57,"y":72},{"x":64,"y":65},{"x":69,"y":56},{"x":74,"y":47},{"x":78,"y":38},{"x":82,"y":29},{"x":86,"y":20}],[{"x":12,"y":14},{"x":15,"y":23},{"x":18,"y":33},{"x":21,"y":42},{"x":23,"y":52},{"x":25,"y":62},{"x":27,"y":72},{"x":29,"y":81},{"x":36,"y":75},{"x":41,"y":66},{"x":46,"y":58},{"x":47,"y":48},{"x":52,"y":56},{"x":59,"y":63},{"x":66,"y":71},{"x":72,"y":78},{"x":78,"y":87},{"x":85,"y":80},{"x":87,"y":70},{"x":88,"y":60},{"x":88,"y":50},{"x":88,"y":40},{"x":88,"y":30},{"x":88,"y":20},{"x":88,"y":10}],[{"x":10,"y":37},{"x":18,"y":43},{"x":24,"y":51},{"x":30,"y":59},{"x":34,"y":68},{"x":40,"y":60},{"x":46,"y":51},{"x":51,"y":43},{"x":57,"y":51},{"x":62,"y":60},{"x":66,"y":69},{"x":70,"y":78},{"x":72,"y":68},{"x":76,"y":59},{"x":80,"y":50},{"x":83,"y":40},{"x":86,"y":31}],[{"x":17,"y":19},{"x":24,"y":26},{"x":31,"y":33},{"x":38,"y":40},{"x":45,"y":48},{"x":52,"y":54},{"x":60,"y":61},{"x":66,"y":68},{"x":73,"y":76},{"x":79,"y":84},{"x":78,"y":74},{"x":77,"y":64},{"x":76,"y":54},{"x":76,"y":44},{"x":75,"y":34},{"x":74,"y":24},{"x":73,"y":14},{"x":65,"y":21},{"x":58,"y":27},{"x":52,"y":35},{"x":47,"y":44},{"x":41,"y":52},{"x":37,"y":61},{"x":32,"y":70},{"x":27,"y":79},{"x":22,"y":87}],[{"x":11,"y":10},{"x":11,"y":20},{"x":11,"y":30},{"x":16,"y":39},{"x":20,"y":48},{"x":30,"y":49},{"x":40,"y":49},{"x":50,"y":49},{"x":60,"y":49},{"x":65,"y":41},{"x":66,"y":31},{"x":66,"y":21},{"x":66,"y":11},{"x":66,"y":21},{"x":65,"y":31},{"x":65,"y":41},{"x":65,"y":51},{"x":65,"y":61},{"x":62,"y":71},{"x":57,"y":80},{"x":49,"y":85},{"x":40,"y":89},{"x":31,"y":94},{"x":25,"y":85},{"x":20,"y":77},{"x":26,"y":68},{"x":33,"y":62},{"x":42,"y":58},{"x":51,"y":53},{"x":61,"y":54},{"x":71,"y":53},{"x":81,"y":52},{"x":91,"y":51}],[{"x":23,"y":20},{"x":27,"y":29},{"x":33,"y":37},{"x":42,"y":43},{"x":52,"y":43},{"x":62,"y":44},{"x":68,"y":36},{"x":75,"y":29},{"x":76,"y":19},{"x":71,"y":27},{"x":67,"y":36},{"x":62,"y":45},{"x":57,"y":53},{"x":50,"y":61},{"x":44,"y":69},{"x":38,"y":77},{"x":33,"y":86}],[{"x":18,"y":10},{"x":22,"y":19},{"x":28,"y":27},{"x":36,"y":33},{"x":44,"y":39},{"x":52,"y":45},{"x":58,"y":38},{"x":65,"y":30},{"x":71,"y":23},{"x":78,"y":15},{"x":73,"y":24},{"x":67,"y":32},{"x":62,"y":41},{"x":57,"y":49},{"x":51,"y":57},{"x":44,"y":65},{"x":40,"y":74},{"x":36,"y":83}],[{"x":31,"y":19},{"x":41,"y":19},{"x":51,"y":19},{"x":61,"y":19},{"x":71,"y":19},{"x":81,"y":19},{"x":75,"y":27},{"x":68,"y":34},{"x":60,"y":40},{"x":51,"y":45},{"x":43,"y":51},{"x":35,"y":57},{"x":28,"y":64},{"x":21,"y":71},{"x":14,"y":78},{"x":23,"y":81},{"x":33,"y":81},{"x":43,"y":81},{"x":53,"y":81},{"x":63,"y":81},{"x":73,"y":81},{"x":83,"y":81},{"x":93,"y":81}],[{"x":21,"y":10},{"x":31,"y":10},{"x":41,"y":10},{"x":51,"y":10},{"x":61,"y":10},{"x":64,"y":20},{"x":58,"y":28},{"x":52,"y":36},{"x":47,"y":44},{"x":41,"y":52},{"x":35,"y":61},{"x":29,"y":69},{"x":27,"y":78},{"x":25,"y":88},{"x":35,"y":90},{"x":45,"y":90},{"x":55,"y":90},{"x":65,"y":90},{"x":75,"y":90}]]
		$(function() {
			for( var i in window.samples ) {
				saveWriting(window.samples[i]);
			}
		});
		
		function vectorlength(pos) {
			return Math.sqrt(Math.pow(pos.x,2)+Math.pow(pos.y,2));
		}
		
		function vectordelta(pos1, pos2) {
			return {
				x: pos2.x - pos1.x,
				y: pos2.y - pos1.y
			}
		}
		
		function normalize(writing) {
			var min = {x:writing[0].x, y:writing[0].y};
			var max = {x:writing[0].x, y:writing[0].y};
			
			for(var i in writing) {
				min.x = Math.min(min.x, writing[i].x);
				min.y = Math.min(min.y, writing[i].y);
				max.x = Math.max(max.x, writing[i].x);
				max.y = Math.max(max.y, writing[i].y);
			}
			
			var boxsize = {x: Math.max(1, max.x-min.x), y: Math.max(1, max.y-min.y)};
			var boxratio = boxsize.x / boxsize.y;
			
			
			// Normalize dimensions to 80% of square.
			var nscale = 80;
			var scale = {};
			if( boxratio >= 1 ) {
				scale.x = nscale;
				scale.y = nscale/boxratio;
			} else {
				scale.y = nscale;
				scale.x = nscale*boxratio;
			}
			var offset = {
				x: (100-scale.x)/2,
				y: (100-scale.y)/2
			}

			var nwriting = [];
			for(var i in writing) {
				var pos = writing[i]
				var npos = {
					x: offset.x + scale.x * ((pos.x - min.x) / boxsize.x),
					y: offset.y + scale.y * ((pos.y - min.y) / boxsize.y)
				}
				nwriting.push(npos);
			}
			
			// Normalize point density to one point per stepsize
			var stepsize = 10;
			var npwriting = [];
			npwriting.push({x:nwriting[0].x, y:nwriting[0].y}	);
			
			var totaldistance = 0;
			var remainingdistance = 0;
			
			var lastpos = nwriting[0];
			for(var i in nwriting) {
				//console.log('i\t' + i);
				var pos = nwriting[i];
				
				var deltapos = {
					x: pos.x - lastpos.x,
					y: pos.y - lastpos.y,
				}
				
				var deltadistance = vectorlength(deltapos);
				
				var steps = Math.floor(deltadistance / stepsize);
				
				var step = 1;
				//console.log('DD\t' + deltapos.x);
				//console.log('RD\t' + remainingdistance);
				remainingdistance += deltadistance;
				var ratio = (stepsize / deltadistance);
				while( ratio <= 1 && remainingdistance > stepsize ) {
					var steppos = {
						x: lastpos.x + deltapos.x * step * ratio,
						y: lastpos.y + deltapos.y * step * ratio
					};
					//console.log('- step\t' + step);
					remainingdistance -= stepsize;
					npwriting.push(steppos);
					step += 1

				}
				
				if( step == 1 ) {
					//lastpos = pos;
					remainingdistance -= deltadistance;
				} else {
					lastpos = steppos;	
				}
				//remainingdistance += deltadistance;
				
			}
			//console.log(npwriting);
			var log = [];
			for( var i in npwriting ) {
				log.push("" + npwriting[i].x + "," + npwriting[i].y);
			}
			//console.log(log);
			return npwriting;
		}
		
			
		function drawWriting(context, writing) {
			//
			context.beginPath();
			context.moveTo(writing[0].x, writing[0].y);
			for( var i in writing ) {
				context.lineTo(writing[i].x, writing[i].y);
			}
			context.lineWidth = 2;
			context.stroke();
			context.fillStyle = 'blue';
			for( var i in writing ) {
				context.fillRect(writing[i].x,writing[i].y,4,4);
			}
		}
		
		function clearCanvas(canvas, context) {
			context.clearRect(0,0,canvas.width, canvas.height);
		}
		
			
		function saveWriting(writing) {				
			cwriting = normalize(writing);

			window.writings.push(cwriting);
			var corpuscanvas = $('<canvas width="100" height="100"/>');
			var corpuscontext = corpuscanvas[0].getContext('2d');
			
			drawWriting(corpuscontext, cwriting);
			
			$("#corpus").append(corpuscanvas);
		}
		
		
		function search(writing, writings) {
			var best = null;
			for(var i in writings) {
				error = similarityerror(writing, writings[i]);
				if( best == null || best.error > error ) {
					best = {
						index: i,
						error: error
					};
				}
			}
			return best;
		}
		
		function similarityerror(qwriting, corpuswriting) {
			var lengthmin = Math.min(qwriting.length, corpuswriting.length);
			var lengthmax = Math.max(qwriting.length, corpuswriting.length);
			var overlap = lengthmin / lengthmax;
			var totalerror = 0;
			
			
			for(var i=0; i<lengthmin; i++) {
				var delta = vectordelta(qwriting[i], corpuswriting[i]);
				var deltalength = vectorlength(delta);
				var error = Math.pow(Math.abs(deltalength),2);
				totalerror += error;
			}
			totalerror /= Math.pow(overlap,2);
			
			return totalerror;
		}
		
		window.context =  null;
		
		$(function(){
			window.canvas = $('#writebox')[0];
			window.context = window.canvas.getContext('2d');
				
			ncanvas = $('#normalized')[0];
			ncontext = ncanvas.getContext('2d');
			/*
			context.beginPath();
			  context.moveTo(x,y);
			  context.lineTo(x,y);
			  context.stroke();
			*/
			$('#writebox').mousedown(function(e) {
				$(this).data('write', true);
				//context.beginPath();
				//context.lineTo(e.offsetX, e.offsetY);
				
			});
			$('#writebox').mouseup(function() {
				$(this).data('write', false);
				
				clearCanvas(canvas, context);
				drawWriting(context, window.writing);
				
				clearCanvas(ncanvas, ncontext);
				drawWriting($("#normalized")[0].getContext('2d'), normalize(window.writing));
			});
			
			$('#writebox').mousemove(function(e) {
				if( $(this).data('write') ) {
					var pos = {x:e.offsetX,y: e.offsetY};
					window.writing.push(pos);
					//context.lineTo(pos.x, pos.y);
				}
			});
			
			$('#save').click(function(e) {
				saveWriting(window.writing);
			});

			
			$('#clear').click(function(e) {
				clearCanvas(canvas, context);

				clearCanvas(ncanvas, ncontext);
				window.writing = [];
			});
			
			$('#search').click(function(e) {
				var best = search(normalize(window.writing), window.writings);
				$('#corpus canvas').css({'background': 'none'});
				$("#corpus canvas").eq(best.index).css({'background':'yellow'});
				console.log(best);
			});

			
			//normalize();
		});
		
		
	</script>
	<style type="text/css">
		
		
		canvas {
			border: 1px solid silver;
		}
		
		#writebox {
			background: #EEE;
		}
		
		#corpus canvas {
			border: 1px solid silver;
		}
		
		fieldset {
			border: 1px solid silver;
			color: silver;
		}
	</style>
</head>
<body>

	
	<h2>Handwriting Recognition</h2>
	<button id="save">Save</button>
	<button id="search">Search</button>
	<button id="clear">Clear</button>
	<br/>
	<table>
	<tr>
	<td>
		Input:<br/>
		<canvas id="writebox" width="100" height="100"></canvas>
	</td>
	<td>
		Normalized input:</br>
		<canvas id="normalized" width="100" height="100"></canvas>
	</td>
	</tr>
	</table>
	<fieldset>
		<legend>Corpus</legend>
	<div id="corpus">
		
	</div>
	</fieldset>
</body>
</html>